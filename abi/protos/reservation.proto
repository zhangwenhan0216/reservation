syntax = "proto3";
package reservation;

import "google/protobuf/timestamp.proto";

enum ReservationStatus {
    RESERVATION_STATUS_UNKNOWN = 0;
    RESERVATION_STATUS_PENDING = 1;
    RESERVATION_STATUS_CONFIRMED = 2;
    RESERVATION_STATUS_BLOCKED = 3;
}

message Reservation {
    int64 id = 1;
    string user_id = 2;
    ReservationStatus status = 3;

    string resource_id = 4;
    google.protobuf.Timestamp start = 5;
    google.protobuf.Timestamp end = 6;

    string note = 7;
}
message ReserveRequest {
    Reservation reservation = 1;
}
message ReserveResponse {
    Reservation reservation = 1;
}
message ConfirmRequest {
    int64 id = 1;
}
message ConfirmResponse {
    Reservation reservation = 1;
}
message ReservationQuery {
    string user_id = 1;
    string resource_id = 2;
    google.protobuf.Timestamp start = 3;
    google.protobuf.Timestamp end = 4;
    ReservationStatus status = 5;
    int32 page = 6;
    int32 page_size = 7;
    // sort direction
    bool desc = 8;
}
message ReservationFilter {
    string user_id = 1;
    string resource_id = 2;
    ReservationStatus status = 3;
    int64 cursor = 4;
    int32 page_size = 5;
    // sort direction
    bool desc = 6;
}
message FilterPager {
    int64 prev = 1;
    int64 next = 2;
    int64 total = 3;
}
message FilterResponse {
    repeated Reservation reservations = 1;
    FilterPager pager = 2;
}
message FilterRequest {
    ReservationFilter filter = 1;
}
message QueryRequest {
    ReservationQuery query = 1;
}
message GetRequest {
    int64 id = 1;
}
message GetResponse {
    Reservation reservation = 1;
}
message UpdateRequest {
    int64 id = 1;
    string note = 2;
}
message UpdateResponse {
    Reservation reservation = 1;
}
message CancelRequest {
    int64 id = 1;
}
message CancelResponse {
    Reservation reservation = 1;
}
service ReservationService {
    rpc reserve(ReserveRequest) returns (ReserveResponse);
    // update status to CONFIRMED
    rpc confirm(ConfirmRequest) returns (ConfirmResponse);
    // update only note
    rpc update(UpdateRequest) returns (UpdateResponse);
    // cancel reservation
    rpc cancel(CancelRequest) returns (CancelResponse);
    // get reservation by id
    rpc get(GetRequest) returns (GetResponse);
    // query reservations with pagination
    rpc query(QueryRequest) returns (stream Reservation);
    // filter reservations order by reservation id
    rpc filter(FilterRequest) returns (FilterResponse);
}



